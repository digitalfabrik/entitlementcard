docker:
  - image: cimg/node:20.18.0
working_directory: ~/project/administration
steps:
  - prepare_workspace
  - check_circleci_config
  - install_protobuf_linux
  - install_node_modules
  - run:
      name: Generate GraphQL
      command: npm run generate-graphql
  - run:
      name: Generate Protobuf
      command: npm run generate-protobuf
  - run:
      name: Typescript
      command: npm run ts:check
  - run:
      name: Lint
      command: npm run lint
  - run:
      name: Check circular dependencies
      command: npm run check-circular-deps
  - run:
      name: Run tests and generate coverage report
      command: npm run test:coverage -- --maxWorkers=2
  - store_artifacts:
      path: src/coverage
      destination: ~/attached_workspace/coverage
  - notify
