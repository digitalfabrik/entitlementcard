parameters:
  platform:
    description: Define the platform that will be used for release name
    default: 'all'
    type: string
docker:
  - image: cimg/node:24.13
resource_class: small
steps:
  - prepare_workspace
  - install_app_toolbelt
  - run:
      name: Remove prerelease flag from github release
      command: |
              RELEASE=$(npx --no app-toolbelt v0 release promote --platform << parameters.platform >> --private-key ${DELIVERINO_PRIVATE_KEY} --owner ${CIRCLE_PROJECT_USERNAME} --repo ${CIRCLE_PROJECT_REPONAME})
              echo "export RELEASE='${RELEASE}'" >> $BASH_ENV
  - notify:
      success_message: "Ehrenamtskarte Bayern, Sozialpass NÃ¼rnberg und Sozialpass Koblenz ${RELEASE} have been promoted successfully to production :tada:"
      channel: releases
      allow_all_branches: true
